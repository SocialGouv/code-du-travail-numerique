{"version":3,"sources":["../../src/conf/elasticsearch.ts"],"sourcesContent":["// https://github.com/elastic/elasticsearch-js\n\nimport type { ClientOptions } from \"@elastic/elasticsearch\";\nimport { Client } from \"@elastic/elasticsearch\";\nimport { logger } from \"@socialgouv/cdtn-logger\";\nimport winston from \"winston\";\n\nconst ELASTICSEARCH_URL =\n  process.env.ELASTICSEARCH_URL ?? \"http://localhost:9200\";\nconst ELASTICSEARCH_TOKEN_API: string | undefined =\n  process.env.ELASTICSEARCH_TOKEN_API;\nconst esClientConfig: ClientOptions = {\n  node: `${ELASTICSEARCH_URL}`,\n};\n\nswitch (process.env.NODE_ENV) {\n  case \"test\":\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    logger.level = winston.warn;\n    break;\n  case \"production\":\n    if (ELASTICSEARCH_TOKEN_API) {\n      esClientConfig.auth = { apiKey: ELASTICSEARCH_TOKEN_API };\n    }\n    break;\n  default:\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-expect-error\n    logger.level = winston.warn;\n    break;\n}\n\nlogger.info(`ElasticSearch at ${ELASTICSEARCH_URL}`);\n\nconst client = new Client(esClientConfig);\n\nexport default client;\n"],"names":["Client","logger","winston","ELASTICSEARCH_URL","process","env","ELASTICSEARCH_TOKEN_API","esClientConfig","node","NODE_ENV","level","warn","auth","apiKey","info","client"],"mappings":"AAAA,8CAA8C;AAG9C,SAASA,MAAM,QAAQ,yBAAyB;AAChD,SAASC,MAAM,QAAQ,0BAA0B;AACjD,OAAOC,aAAa,UAAU;AAE9B,MAAMC,oBACJC,QAAQC,GAAG,CAACF,iBAAiB,IAAI;AACnC,MAAMG,0BACJF,QAAQC,GAAG,CAACC,uBAAuB;AACrC,MAAMC,iBAAgC;IACpCC,MAAM,CAAC,EAAEL,kBAAkB,CAAC;AAC9B;AAEA,OAAQC,QAAQC,GAAG,CAACI,QAAQ;IAC1B,KAAK;QACH,6DAA6D;QAC7D,mBAAmB;QACnBR,OAAOS,KAAK,GAAGR,QAAQS,IAAI;QAC3B,KAAM;IACR,KAAK;QACH,IAAIL,yBAAyB;YAC3BC,eAAeK,IAAI,GAAG;gBAAEC,QAAQP;YAAwB;QAC1D,CAAC;QACD,KAAM;IACR;QACE,6DAA6D;QAC7D,mBAAmB;QACnBL,OAAOS,KAAK,GAAGR,QAAQS,IAAI;QAC3B,KAAM;AACV;AAEAV,OAAOa,IAAI,CAAC,CAAC,iBAAiB,EAAEX,kBAAkB,CAAC;AAEnD,MAAMY,SAAS,IAAIf,OAAOO;AAE1B,eAAeQ,OAAO"}