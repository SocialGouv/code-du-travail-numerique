{"version":3,"sources":["../../../src/routes/themes/index.js"],"sourcesContent":["import elasticsearchClient from \"../../conf/elasticsearch\";\nimport { API_BASE_URL, CDTN_ADMIN_VERSION } from \"../v1.prefix\";\n\nconst Router = require(\"koa-router\");\nconst { DOCUMENTS } = require(\"@socialgouv/cdtn-elasticsearch\");\nconst { getRootThemesQuery, getThemeQuery } = require(\"./search.elastic.js\");\n\nconst ES_INDEX_PREFIX = process.env.ES_INDEX_PREFIX || \"cdtn\";\nconst index = `${ES_INDEX_PREFIX}-${CDTN_ADMIN_VERSION}_${DOCUMENTS}`;\n\nconst router = new Router({ prefix: API_BASE_URL });\n\n/**\n * Return the root themes\n *\n * @example\n * http://localhost:1337/api/v1/themes\n *\n * @returns {Object} An object containing the matching theme .\n */\nrouter.get(\"/themes\", async (ctx) => {\n  const body = getRootThemesQuery({});\n  const response = await elasticsearchClient.search({\n    body,\n    index,\n  });\n  ctx.body = {\n    children: response.body.hits.hits.map((t) => t._source),\n  };\n});\n\n/**\n * Return the theme that match a given slug\n *\n * @example\n * http://localhost:1337/api/v1/themes/:slug\n *\n * @returns {Object} An object containing the matching theme .\n */\n\nrouter.get(\"/themes/:slug\", async (ctx) => {\n  const { slug } = ctx.params;\n  const body = getThemeQuery({ slug });\n  const response = await elasticsearchClient.search({\n    body,\n    index,\n  });\n  if (response.body.hits.hits.length === 0) {\n    ctx.throw(404, `there is no theme that match ${slug}`);\n  }\n\n  const theme = response.body.hits.hits[0];\n\n  ctx.body = {\n    ...theme._source,\n  };\n});\n\nexport default router;\n"],"names":["elasticsearchClient","API_BASE_URL","CDTN_ADMIN_VERSION","Router","require","DOCUMENTS","getRootThemesQuery","getThemeQuery","ES_INDEX_PREFIX","process","env","index","router","prefix","get","ctx","body","response","search","children","hits","map","t","_source","slug","params","length","throw","theme"],"mappings":"AAAA,OAAOA,yBAAyB,2BAA2B;AAC3D,SAASC,YAAY,EAAEC,kBAAkB,QAAQ,eAAe;AAEhE,MAAMC,SAASC,QAAQ;AACvB,MAAM,EAAEC,UAAS,EAAE,GAAGD,QAAQ;AAC9B,MAAM,EAAEE,mBAAkB,EAAEC,cAAa,EAAE,GAAGH,QAAQ;AAEtD,MAAMI,kBAAkBC,QAAQC,GAAG,CAACF,eAAe,IAAI;AACvD,MAAMG,QAAQ,CAAC,EAAEH,gBAAgB,CAAC,EAAEN,mBAAmB,CAAC,EAAEG,UAAU,CAAC;AAErE,MAAMO,SAAS,IAAIT,OAAO;IAAEU,QAAQZ;AAAa;AAEjD;;;;;;;CAOC,GACDW,OAAOE,GAAG,CAAC,WAAW,OAAOC,MAAQ;IACnC,MAAMC,OAAOV,mBAAmB,CAAC;IACjC,MAAMW,WAAW,MAAMjB,oBAAoBkB,MAAM,CAAC;QAChDF;QACAL;IACF;IACAI,IAAIC,IAAI,GAAG;QACTG,UAAUF,SAASD,IAAI,CAACI,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAACC,IAAMA,EAAEC,OAAO;IACxD;AACF;AAEA;;;;;;;CAOC,GAEDX,OAAOE,GAAG,CAAC,iBAAiB,OAAOC,MAAQ;IACzC,MAAM,EAAES,KAAI,EAAE,GAAGT,IAAIU,MAAM;IAC3B,MAAMT,OAAOT,cAAc;QAAEiB;IAAK;IAClC,MAAMP,WAAW,MAAMjB,oBAAoBkB,MAAM,CAAC;QAChDF;QACAL;IACF;IACA,IAAIM,SAASD,IAAI,CAACI,IAAI,CAACA,IAAI,CAACM,MAAM,KAAK,GAAG;QACxCX,IAAIY,KAAK,CAAC,KAAK,CAAC,6BAA6B,EAAEH,KAAK,CAAC;IACvD,CAAC;IAED,MAAMI,QAAQX,SAASD,IAAI,CAACI,IAAI,CAACA,IAAI,CAAC,EAAE;IAExCL,IAAIC,IAAI,GAAG;QACT,GAAGY,MAAML,OAAO;IAClB;AACF;AAEA,eAAeX,OAAO"}