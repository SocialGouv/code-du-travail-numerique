{"version":3,"sources":["../../../src/routes/idcc/index.js"],"sourcesContent":["import elasticsearchClient from \"../../conf/elasticsearch\";\nimport { API_BASE_URL, CDTN_ADMIN_VERSION } from \"../v1.prefix\";\n\nconst Router = require(\"koa-router\");\nconst { DOCUMENTS } = require(\"@socialgouv/cdtn-elasticsearch\");\nconst getIdccBody = require(\"./idcc.elastic\");\n\nconst ES_INDEX_PREFIX = process.env.ES_INDEX_PREFIX || \"cdtn\";\nconst index = `${ES_INDEX_PREFIX}-${CDTN_ADMIN_VERSION}_${DOCUMENTS}`;\n\nconst router = new Router({ prefix: API_BASE_URL });\n\nexport const parseIdcc = (query) =>\n  /^\\d+$/.test(query) ? parseInt(query, 10) : undefined;\n\n/**\n * Return documents matching the given query.\n *\n * @example\n * http://localhost:1337/api/v1/idcc?q=banlangerie\n * http://localhost:1337/api/v1/idcc?q=843\n * http://localhost:1337/api/v1/idcc?q=1020Z\n *\n * @param {string} querystring.q A `q` querystring param containing the query to process.\n * @returns {Object} Results.\n */\nrouter.get(\"/idcc\", async (ctx) => {\n  const query = ctx.request.query.q;\n\n  // if only digit within query we make it a pure idcc search (like 1234)\n  const idccQuery = parseIdcc(query);\n\n  const body = getIdccBody({ idccQuery, query });\n\n  const response = await elasticsearchClient.search({ body, index });\n  ctx.body = { ...response.body };\n});\n\nexport default router;\n"],"names":["elasticsearchClient","API_BASE_URL","CDTN_ADMIN_VERSION","Router","require","DOCUMENTS","getIdccBody","ES_INDEX_PREFIX","process","env","index","router","prefix","parseIdcc","query","test","parseInt","undefined","get","ctx","request","q","idccQuery","body","response","search"],"mappings":"AAAA,OAAOA,yBAAyB,2BAA2B;AAC3D,SAASC,YAAY,EAAEC,kBAAkB,QAAQ,eAAe;AAEhE,MAAMC,SAASC,QAAQ;AACvB,MAAM,EAAEC,UAAS,EAAE,GAAGD,QAAQ;AAC9B,MAAME,cAAcF,QAAQ;AAE5B,MAAMG,kBAAkBC,QAAQC,GAAG,CAACF,eAAe,IAAI;AACvD,MAAMG,QAAQ,CAAC,EAAEH,gBAAgB,CAAC,EAAEL,mBAAmB,CAAC,EAAEG,UAAU,CAAC;AAErE,MAAMM,SAAS,IAAIR,OAAO;IAAES,QAAQX;AAAa;AAEjD,OAAO,MAAMY,YAAY,CAACC,QACxB,QAAQC,IAAI,CAACD,SAASE,SAASF,OAAO,MAAMG,SAAS,CAAC;AAExD;;;;;;;;;;CAUC,GACDN,OAAOO,GAAG,CAAC,SAAS,OAAOC,MAAQ;IACjC,MAAML,QAAQK,IAAIC,OAAO,CAACN,KAAK,CAACO,CAAC;IAEjC,uEAAuE;IACvE,MAAMC,YAAYT,UAAUC;IAE5B,MAAMS,OAAOjB,YAAY;QAAEgB;QAAWR;IAAM;IAE5C,MAAMU,WAAW,MAAMxB,oBAAoByB,MAAM,CAAC;QAAEF;QAAMb;IAAM;IAChES,IAAII,IAAI,GAAG;QAAE,GAAGC,SAASD,IAAI;IAAC;AAChC;AAEA,eAAeZ,OAAO"}