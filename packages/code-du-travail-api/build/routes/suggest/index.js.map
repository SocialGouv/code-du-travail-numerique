{"version":3,"sources":["../../../src/routes/suggest/index.js"],"sourcesContent":["import elasticsearchClient from \"../../conf/elasticsearch\";\nimport { API_BASE_URL, CDTN_ADMIN_VERSION } from \"../v1.prefix\";\n\nconst Router = require(\"koa-router\");\nconst { SUGGESTIONS } = require(\"@socialgouv/cdtn-elasticsearch\");\nconst { getSuggestQuery } = require(\"./suggest.elastic.js\");\n\nconst ES_INDEX_PREFIX = process.env.ES_INDEX_PREFIX || \"cdtn\";\nconst index = `${ES_INDEX_PREFIX}-${CDTN_ADMIN_VERSION}_${SUGGESTIONS}`;\n\nconst router = new Router({ prefix: API_BASE_URL });\n\nconst minQueryLength = 2;\nconst suggestionsSize = 5;\n\n/**\n * Return the search suggestion\n *\n * @example\n * http://localhost:1337/api/v1/suggest?q=aba\n *\n * @returns {Object} List of matching suggestions.\n */\nrouter.get(\"/suggest\", async (ctx) => {\n  const { q = \"\", size = suggestionsSize } = ctx.request.query;\n\n  if (q.length >= minQueryLength) {\n    const body = getSuggestQuery(q, size);\n    const response = await elasticsearchClient.search({\n      body,\n      index,\n    });\n    ctx.body = response.body.hits.hits.map((t) => t._source.title);\n  } else {\n    ctx.body = [];\n  }\n});\n\nexport default router;\n"],"names":["elasticsearchClient","API_BASE_URL","CDTN_ADMIN_VERSION","Router","require","SUGGESTIONS","getSuggestQuery","ES_INDEX_PREFIX","process","env","index","router","prefix","minQueryLength","suggestionsSize","get","ctx","q","size","request","query","length","body","response","search","hits","map","t","_source","title"],"mappings":"AAAA,OAAOA,yBAAyB,2BAA2B;AAC3D,SAASC,YAAY,EAAEC,kBAAkB,QAAQ,eAAe;AAEhE,MAAMC,SAASC,QAAQ;AACvB,MAAM,EAAEC,YAAW,EAAE,GAAGD,QAAQ;AAChC,MAAM,EAAEE,gBAAe,EAAE,GAAGF,QAAQ;AAEpC,MAAMG,kBAAkBC,QAAQC,GAAG,CAACF,eAAe,IAAI;AACvD,MAAMG,QAAQ,CAAC,EAAEH,gBAAgB,CAAC,EAAEL,mBAAmB,CAAC,EAAEG,YAAY,CAAC;AAEvE,MAAMM,SAAS,IAAIR,OAAO;IAAES,QAAQX;AAAa;AAEjD,MAAMY,iBAAiB;AACvB,MAAMC,kBAAkB;AAExB;;;;;;;CAOC,GACDH,OAAOI,GAAG,CAAC,YAAY,OAAOC,MAAQ;IACpC,MAAM,EAAEC,GAAI,GAAE,EAAEC,MAAOJ,gBAAe,EAAE,GAAGE,IAAIG,OAAO,CAACC,KAAK;IAE5D,IAAIH,EAAEI,MAAM,IAAIR,gBAAgB;QAC9B,MAAMS,OAAOhB,gBAAgBW,GAAGC;QAChC,MAAMK,WAAW,MAAMvB,oBAAoBwB,MAAM,CAAC;YAChDF;YACAZ;QACF;QACAM,IAAIM,IAAI,GAAGC,SAASD,IAAI,CAACG,IAAI,CAACA,IAAI,CAACC,GAAG,CAAC,CAACC,IAAMA,EAAEC,OAAO,CAACC,KAAK;IAC/D,OAAO;QACLb,IAAIM,IAAI,GAAG,EAAE;IACf,CAAC;AACH;AAEA,eAAeX,OAAO"}