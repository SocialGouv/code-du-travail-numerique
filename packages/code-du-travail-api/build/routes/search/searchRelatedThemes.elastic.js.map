{"version":3,"sources":["../../../src/routes/search/searchRelatedThemes.elastic.js"],"sourcesContent":["const { SOURCES } = require(\"@socialgouv/cdtn-sources\");\n\n/**\n * This query is intended to work on theme index\n * @param  {string} a string to match\n * @param {number} maximum number of returned elements\n * @returns {Array} an array of theme documents\n */\nfunction getRelatedThemesBody({ query, size = 5 }) {\n  return {\n    _source: [\"icon\", \"title\", \"slug\", \"url\", \"source\", \"cdtnId\"],\n    query: {\n      bool: {\n        filter: [\n          { term: { source: `${SOURCES.THEMES}` } },\n          { term: { isPublished: true } },\n        ],\n        must: {\n          match: {\n            title: {\n              fuzziness: \"auto\",\n              query: `${query}`,\n            },\n          },\n        },\n        should: {\n          match: {\n            \"breadcrumbs.label\": {\n              fuzziness: \"auto\",\n              query: `${query}`,\n            },\n          },\n        },\n      },\n    },\n    size,\n  };\n}\n\nmodule.exports = getRelatedThemesBody;\n"],"names":["SOURCES","require","getRelatedThemesBody","query","size","_source","bool","filter","term","source","THEMES","isPublished","must","match","title","fuzziness","should","module","exports"],"mappings":"AAAA,MAAM,EAAEA,QAAO,EAAE,GAAGC,QAAQ;AAE5B;;;;;CAKC,GACD,SAASC,qBAAqB,EAAEC,MAAK,EAAEC,MAAO,EAAC,EAAE,EAAE;IACjD,OAAO;QACLC,SAAS;YAAC;YAAQ;YAAS;YAAQ;YAAO;YAAU;SAAS;QAC7DF,OAAO;YACLG,MAAM;gBACJC,QAAQ;oBACN;wBAAEC,MAAM;4BAAEC,QAAQ,CAAC,EAAET,QAAQU,MAAM,CAAC,CAAC;wBAAC;oBAAE;oBACxC;wBAAEF,MAAM;4BAAEG,aAAa,IAAI;wBAAC;oBAAE;iBAC/B;gBACDC,MAAM;oBACJC,OAAO;wBACLC,OAAO;4BACLC,WAAW;4BACXZ,OAAO,CAAC,EAAEA,MAAM,CAAC;wBACnB;oBACF;gBACF;gBACAa,QAAQ;oBACNH,OAAO;wBACL,qBAAqB;4BACnBE,WAAW;4BACXZ,OAAO,CAAC,EAAEA,MAAM,CAAC;wBACnB;oBACF;gBACF;YACF;QACF;QACAC;IACF;AACF;AAEAa,OAAOC,OAAO,GAAGhB"}