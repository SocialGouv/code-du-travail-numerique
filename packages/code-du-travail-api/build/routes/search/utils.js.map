{"version":3,"sources":["../../../src/routes/search/utils.js"],"sourcesContent":["import { getRouteBySource } from \"@socialgouv/cdtn-sources\";\n// merge by one of each\n\nconst merge = (res1, res2, max_result) => {\n  //  simple array concat\n  // return [...res1.hits, ...res2.hits].sort(sortByScore);\n\n  // interleave results\n  const res = [];\n  Array.from({\n    length: max_result,\n  }).forEach((x, i) => {\n    if (res1.length > i) res.push(res1[i]);\n    if (res2.length > i) res.push(res2[i]);\n  });\n  return res;\n};\n\n// Remove Duplicates\nconst predicateFn = ({ _source: { source, slug } }) =>\n  `${getRouteBySource(source) || source}/${slug}`;\n\nconst removeDuplicate = (arr, predicate = predicateFn) =>\n  arr.flatMap((a, index) => {\n    if (arr.find((item, i) => predicate(item) === predicate(a) && i < index)) {\n      return [];\n    } else {\n      return a;\n    }\n  });\n\nconst mergeDuplicate = (arr, predicate = predicateFn) => {\n  return arr.flatMap((a, index) => {\n    const prevItem = arr.find(\n      (item, i) => predicate(item) === predicate(a) && i < index\n    );\n    if (prevItem) {\n      prevItem._source.algo = \"both\";\n      return [];\n    } else {\n      return a;\n    }\n  });\n};\n\nconst mergePipe = (a, b, max_result) => {\n  const res = merge(a, b, a.length + b.length);\n  return mergeDuplicate(res).slice(0, max_result);\n};\n\nexports.merge = merge;\nexports.removeDuplicate = removeDuplicate;\nexports.mergePipe = mergePipe;\n"],"names":["getRouteBySource","merge","res1","res2","max_result","res","Array","from","length","forEach","x","i","push","predicateFn","_source","source","slug","removeDuplicate","arr","predicate","flatMap","a","index","find","item","mergeDuplicate","prevItem","algo","mergePipe","b","slice","exports"],"mappings":"AAAA,SAASA,gBAAgB,QAAQ,2BAA2B;AAC5D,uBAAuB;AAEvB,MAAMC,QAAQ,CAACC,MAAMC,MAAMC,aAAe;IACxC,uBAAuB;IACvB,yDAAyD;IAEzD,qBAAqB;IACrB,MAAMC,MAAM,EAAE;IACdC,MAAMC,IAAI,CAAC;QACTC,QAAQJ;IACV,GAAGK,OAAO,CAAC,CAACC,GAAGC,IAAM;QACnB,IAAIT,KAAKM,MAAM,GAAGG,GAAGN,IAAIO,IAAI,CAACV,IAAI,CAACS,EAAE;QACrC,IAAIR,KAAKK,MAAM,GAAGG,GAAGN,IAAIO,IAAI,CAACT,IAAI,CAACQ,EAAE;IACvC;IACA,OAAON;AACT;AAEA,oBAAoB;AACpB,MAAMQ,cAAc,CAAC,EAAEC,SAAS,EAAEC,OAAM,EAAEC,KAAI,EAAE,CAAA,EAAE,GAChD,CAAC,EAAEhB,iBAAiBe,WAAWA,OAAO,CAAC,EAAEC,KAAK,CAAC;AAEjD,MAAMC,kBAAkB,CAACC,KAAKC,YAAYN,WAAW,GACnDK,IAAIE,OAAO,CAAC,CAACC,GAAGC,QAAU;QACxB,IAAIJ,IAAIK,IAAI,CAAC,CAACC,MAAMb,IAAMQ,UAAUK,UAAUL,UAAUE,MAAMV,IAAIW,QAAQ;YACxE,OAAO,EAAE;QACX,OAAO;YACL,OAAOD;QACT,CAAC;IACH;AAEF,MAAMI,iBAAiB,CAACP,KAAKC,YAAYN,WAAW,GAAK;IACvD,OAAOK,IAAIE,OAAO,CAAC,CAACC,GAAGC,QAAU;QAC/B,MAAMI,WAAWR,IAAIK,IAAI,CACvB,CAACC,MAAMb,IAAMQ,UAAUK,UAAUL,UAAUE,MAAMV,IAAIW;QAEvD,IAAII,UAAU;YACZA,SAASZ,OAAO,CAACa,IAAI,GAAG;YACxB,OAAO,EAAE;QACX,OAAO;YACL,OAAON;QACT,CAAC;IACH;AACF;AAEA,MAAMO,YAAY,CAACP,GAAGQ,GAAGzB,aAAe;IACtC,MAAMC,MAAMJ,MAAMoB,GAAGQ,GAAGR,EAAEb,MAAM,GAAGqB,EAAErB,MAAM;IAC3C,OAAOiB,eAAepB,KAAKyB,KAAK,CAAC,GAAG1B;AACtC;AAEA2B,QAAQ9B,KAAK,GAAGA;AAChB8B,QAAQd,eAAe,GAAGA;AAC1Bc,QAAQH,SAAS,GAAGA"}