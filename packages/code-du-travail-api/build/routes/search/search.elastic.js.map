{"version":3,"sources":["../../../src/routes/search/search.elastic.js"],"sourcesContent":["const sourcesFilter = require(\"./sourcesFilter.elastic\");\nconst { SOURCES } = require(\"@socialgouv/cdtn-sources\");\n\nfunction getSearchBody({ query, size, sources = [] }) {\n  if (sources.length === 0) {\n    throw new Error(\"[getSearchBody] sources should not be empty\");\n  }\n\n  return {\n    _source: [\n      \"title\",\n      \"source\",\n      \"slug\",\n      \"description\",\n      \"url\",\n      \"action\",\n      \"breadcrumbs\",\n      \"cdtnId\",\n      \"highlight\",\n    ],\n    query: {\n      bool: {\n        filter: [\n          { term: { excludeFromSearch: false } },\n          { term: { isPublished: true } },\n        ],\n        must: [\n          {\n            bool: {\n              should: [\n                {\n                  multi_match: {\n                    boost: 0.1,\n                    fields: [\"text.french\", \"title.french\"],\n                    minimum_should_match: \"1<99% 3<75% 6<30%\",\n                    query: query,\n                    type: \"cross_fields\",\n                  },\n                },\n                {\n                  match: {\n                    \"text.french_with_synonyms\": {\n                      query: query,\n                    },\n                  },\n                },\n                {\n                  match: {\n                    \"synonymes.french\": {\n                      boost: 30,\n                      query,\n                    },\n                  },\n                },\n              ],\n            },\n          },\n        ].concat(sourcesFilter(sources)),\n        should: [\n          {\n            match_phrase: {\n              \"title.french\": {\n                boost: 2,\n                query: `__start__ ${query}`,\n                slop: 1,\n              },\n            },\n          },\n          {\n            match_phrase: {\n              \"text.french\": {\n                boost: 1.5,\n                query: query,\n              },\n            },\n          },\n          {\n            match: {\n              \"title.french_with_synonyms\": {\n                query: query,\n              },\n            },\n          },\n          {\n            match: {\n              source: {\n                boost: 1.2,\n                query: SOURCES.CONTRIBUTIONS,\n              },\n            },\n          },\n          {\n            match: {\n              source: {\n                boost: 1.1,\n                query: SOURCES.TOOLS,\n              },\n            },\n          },\n          {\n            match: {\n              source: {\n                boost: 1.1,\n                query: SOURCES.LETTERS,\n              },\n            },\n          },\n        ],\n      },\n    },\n    size: size,\n  };\n}\n\nmodule.exports = getSearchBody;\n"],"names":["sourcesFilter","require","SOURCES","getSearchBody","query","size","sources","length","Error","_source","bool","filter","term","excludeFromSearch","isPublished","must","should","multi_match","boost","fields","minimum_should_match","type","match","concat","match_phrase","slop","source","CONTRIBUTIONS","TOOLS","LETTERS","module","exports"],"mappings":"AAAA,MAAMA,gBAAgBC,QAAQ;AAC9B,MAAM,EAAEC,QAAO,EAAE,GAAGD,QAAQ;AAE5B,SAASE,cAAc,EAAEC,MAAK,EAAEC,KAAI,EAAEC,SAAU,EAAE,CAAA,EAAE,EAAE;IACpD,IAAIA,QAAQC,MAAM,KAAK,GAAG;QACxB,MAAM,IAAIC,MAAM,+CAA+C;IACjE,CAAC;IAED,OAAO;QACLC,SAAS;YACP;YACA;YACA;YACA;YACA;YACA;YACA;YACA;YACA;SACD;QACDL,OAAO;YACLM,MAAM;gBACJC,QAAQ;oBACN;wBAAEC,MAAM;4BAAEC,mBAAmB,KAAK;wBAAC;oBAAE;oBACrC;wBAAED,MAAM;4BAAEE,aAAa,IAAI;wBAAC;oBAAE;iBAC/B;gBACDC,MAAM;oBACJ;wBACEL,MAAM;4BACJM,QAAQ;gCACN;oCACEC,aAAa;wCACXC,OAAO;wCACPC,QAAQ;4CAAC;4CAAe;yCAAe;wCACvCC,sBAAsB;wCACtBhB,OAAOA;wCACPiB,MAAM;oCACR;gCACF;gCACA;oCACEC,OAAO;wCACL,6BAA6B;4CAC3BlB,OAAOA;wCACT;oCACF;gCACF;gCACA;oCACEkB,OAAO;wCACL,oBAAoB;4CAClBJ,OAAO;4CACPd;wCACF;oCACF;gCACF;6BACD;wBACH;oBACF;iBACD,CAACmB,MAAM,CAACvB,cAAcM;gBACvBU,QAAQ;oBACN;wBACEQ,cAAc;4BACZ,gBAAgB;gCACdN,OAAO;gCACPd,OAAO,CAAC,UAAU,EAAEA,MAAM,CAAC;gCAC3BqB,MAAM;4BACR;wBACF;oBACF;oBACA;wBACED,cAAc;4BACZ,eAAe;gCACbN,OAAO;gCACPd,OAAOA;4BACT;wBACF;oBACF;oBACA;wBACEkB,OAAO;4BACL,8BAA8B;gCAC5BlB,OAAOA;4BACT;wBACF;oBACF;oBACA;wBACEkB,OAAO;4BACLI,QAAQ;gCACNR,OAAO;gCACPd,OAAOF,QAAQyB,aAAa;4BAC9B;wBACF;oBACF;oBACA;wBACEL,OAAO;4BACLI,QAAQ;gCACNR,OAAO;gCACPd,OAAOF,QAAQ0B,KAAK;4BACtB;wBACF;oBACF;oBACA;wBACEN,OAAO;4BACLI,QAAQ;gCACNR,OAAO;gCACPd,OAAOF,QAAQ2B,OAAO;4BACxB;wBACF;oBACF;iBACD;YACH;QACF;QACAxB,MAAMA;IACR;AACF;AAEAyB,OAAOC,OAAO,GAAG5B"}