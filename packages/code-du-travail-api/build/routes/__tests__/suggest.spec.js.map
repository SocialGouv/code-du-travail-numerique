{"version":3,"sources":["../../../src/routes/__tests__/suggest.spec.js"],"sourcesContent":["import router from \"../suggest\";\n\nconst request = require(\"supertest\");\nconst Koa = require(\"koa\");\n\nconst app = new Koa();\napp.use(router.routes());\n\nasync function getSuggestions(query) {\n  return request(app.callback()).get(`/api/v1/suggest?q=` + query);\n}\n\ntest(\"return suggestions for re in the right format\", async () => {\n  const response = await getSuggestions(\"re\");\n  expect(response.status).toBe(200);\n  expect(response.get(\"Content-Type\")).toMatch(/json/);\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(\"accentuation is ignored\", async () => {\n  const response = await getSuggestions(\"ré\");\n  expect(response.body.includes(\"retraite\")).toBeTruthy();\n});\n\ntest(`when query match several suggestions with same rank, \n  ensure order is based on query prefix matching position`, async () => {\n  const response = await getSuggestions(\"ré\");\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(`when query match several suggestions with same prefix, \n  ensure order is based on rank`, async () => {\n  const response = await getSuggestions(\"re\");\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(\"fuzzy matching works\", async () => {\n  const response = await getSuggestions(\"reta\");\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(\"fuzzy matching results are lower than exact matchs\", async () => {\n  const response = await getSuggestions(\"con\");\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(\"ensure results are only returned when enough characters passed\", async () => {\n  const response = await getSuggestions(\"d\");\n  expect(response.body).toMatchSnapshot();\n});\n"],"names":["router","request","require","Koa","app","use","routes","getSuggestions","query","callback","get","test","response","expect","status","toBe","toMatch","body","toMatchSnapshot","includes","toBeTruthy"],"mappings":"AAAA,OAAOA,YAAY,aAAa;AAEhC,MAAMC,UAAUC,QAAQ;AACxB,MAAMC,MAAMD,QAAQ;AAEpB,MAAME,MAAM,IAAID;AAChBC,IAAIC,GAAG,CAACL,OAAOM,MAAM;AAErB,eAAeC,eAAeC,KAAK,EAAE;IACnC,OAAOP,QAAQG,IAAIK,QAAQ,IAAIC,GAAG,CAAC,CAAC,kBAAkB,CAAC,GAAGF;AAC5D;AAEAG,KAAK,iDAAiD,UAAY;IAChE,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASE,MAAM,EAAEC,IAAI,CAAC;IAC7BF,OAAOD,SAASF,GAAG,CAAC,iBAAiBM,OAAO,CAAC;IAC7CH,OAAOD,SAASK,IAAI,EAAEC,eAAe;AACvC;AAEAP,KAAK,2BAA2B,UAAY;IAC1C,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASK,IAAI,CAACE,QAAQ,CAAC,aAAaC,UAAU;AACvD;AAEAT,KAAK,CAAC;yDACmD,CAAC,EAAE,UAAY;IACtE,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASK,IAAI,EAAEC,eAAe;AACvC;AAEAP,KAAK,CAAC;+BACyB,CAAC,EAAE,UAAY;IAC5C,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASK,IAAI,EAAEC,eAAe;AACvC;AAEAP,KAAK,wBAAwB,UAAY;IACvC,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASK,IAAI,EAAEC,eAAe;AACvC;AAEAP,KAAK,sDAAsD,UAAY;IACrE,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASK,IAAI,EAAEC,eAAe;AACvC;AAEAP,KAAK,kEAAkE,UAAY;IACjF,MAAMC,WAAW,MAAML,eAAe;IACtCM,OAAOD,SAASK,IAAI,EAAEC,eAAe;AACvC"}