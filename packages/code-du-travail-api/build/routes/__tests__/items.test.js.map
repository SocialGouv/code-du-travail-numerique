{"version":3,"sources":["../../../src/routes/__tests__/items.test.js"],"sourcesContent":["import router from \"../items\";\n\nconst request = require(\"supertest\");\nconst Koa = require(\"koa\");\n\nrequire(\"./__mocking__/mockNLP\");\n\njest.mock(\"@socialgouv/cdtn-elasticsearch\");\n\nconst app = new Koa();\napp.use(router.routes());\n\ntest(\"return item from its id\", async () => {\n  const response = await request(app.callback()).get(`/api/v1/items/9`);\n  expect(response.status).toBe(200);\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(\"return item from source and slug\", async () => {\n  const response = await request(app.callback()).get(\n    `/api/v1/items/fiches_service_public/demission-dun-salarie`\n  );\n  expect(response.status).toBe(200);\n  expect(response.body).toMatchSnapshot();\n});\n\ntest(\"ensure related items do not include queried item\", async () => {\n  const source = \"fiches_service_public\";\n  const slug = \"demission-dun-salarie\";\n  const response = await request(app.callback()).get(\n    `/api/v1/items/${source}/${slug}`\n  );\n  expect(response.status).toBe(200);\n  expect(\n    response.body.relatedItems.map(({ slug, source }) => ({ slug, source }))\n  ).not.toContainEqual({ slug, source });\n});\n\ntest(\"return item from its url\", async () => {\n  const response = await request(app.callback()).get(\n    `/api/v1/items?url=https://www.service-public.fr/particuliers/vosdroits/F2883`\n  );\n  expect(response.status).toBe(200);\n  expect(response.body).toMatchSnapshot();\n});\n"],"names":["router","request","require","Koa","jest","mock","app","use","routes","test","response","callback","get","expect","status","toBe","body","toMatchSnapshot","source","slug","relatedItems","map","not","toContainEqual"],"mappings":"AAAA,OAAOA,YAAY,WAAW;AAE9B,MAAMC,UAAUC,QAAQ;AACxB,MAAMC,MAAMD,QAAQ;AAEpBA,QAAQ;AAERE,KAAKC,IAAI,CAAC;AAEV,MAAMC,MAAM,IAAIH;AAChBG,IAAIC,GAAG,CAACP,OAAOQ,MAAM;AAErBC,KAAK,2BAA2B,UAAY;IAC1C,MAAMC,WAAW,MAAMT,QAAQK,IAAIK,QAAQ,IAAIC,GAAG,CAAC,CAAC,eAAe,CAAC;IACpEC,OAAOH,SAASI,MAAM,EAAEC,IAAI,CAAC;IAC7BF,OAAOH,SAASM,IAAI,EAAEC,eAAe;AACvC;AAEAR,KAAK,oCAAoC,UAAY;IACnD,MAAMC,WAAW,MAAMT,QAAQK,IAAIK,QAAQ,IAAIC,GAAG,CAChD,CAAC,yDAAyD,CAAC;IAE7DC,OAAOH,SAASI,MAAM,EAAEC,IAAI,CAAC;IAC7BF,OAAOH,SAASM,IAAI,EAAEC,eAAe;AACvC;AAEAR,KAAK,oDAAoD,UAAY;IACnE,MAAMS,SAAS;IACf,MAAMC,OAAO;IACb,MAAMT,WAAW,MAAMT,QAAQK,IAAIK,QAAQ,IAAIC,GAAG,CAChD,CAAC,cAAc,EAAEM,OAAO,CAAC,EAAEC,KAAK,CAAC;IAEnCN,OAAOH,SAASI,MAAM,EAAEC,IAAI,CAAC;IAC7BF,OACEH,SAASM,IAAI,CAACI,YAAY,CAACC,GAAG,CAAC,CAAC,EAAEF,KAAI,EAAED,OAAM,EAAE,GAAM,CAAA;YAAEC;YAAMD;QAAO,CAAA,IACrEI,GAAG,CAACC,cAAc,CAAC;QAAEJ;QAAMD;IAAO;AACtC;AAEAT,KAAK,4BAA4B,UAAY;IAC3C,MAAMC,WAAW,MAAMT,QAAQK,IAAIK,QAAQ,IAAIC,GAAG,CAChD,CAAC,4EAA4E,CAAC;IAEhFC,OAAOH,SAASI,MAAM,EAAEC,IAAI,CAAC;IAC7BF,OAAOH,SAASM,IAAI,EAAEC,eAAe;AACvC"}