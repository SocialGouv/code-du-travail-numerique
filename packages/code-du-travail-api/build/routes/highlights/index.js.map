{"version":3,"sources":["../../../src/routes/highlights/index.js"],"sourcesContent":["import elasticsearchClient from \"../../conf/elasticsearch\";\nimport { API_BASE_URL, CDTN_ADMIN_VERSION } from \"../v1.prefix\";\n\nconst Router = require(\"koa-router\");\nconst { DOCUMENTS } = require(\"@socialgouv/cdtn-elasticsearch\");\nconst getHightlightsBody = require(\"./highlight.elastic\");\n\nconst ES_INDEX_PREFIX = process.env.ES_INDEX_PREFIX || \"cdtn\";\nconst index = `${ES_INDEX_PREFIX}-${CDTN_ADMIN_VERSION}_${DOCUMENTS}`;\n\nconst router = new Router({ prefix: API_BASE_URL });\n\n/**\n * Return the highlights that match a given slug\n *\n * @example\n * http://localhost:1337/api/v1/highlights/:slug\n *\n * @returns {Object} An object containing the matching theme.\n */\n\nrouter.get(\"/highlights/:slug\", async (ctx) => {\n  const { slug } = ctx.params;\n  const body = getHightlightsBody({ slug });\n\n  const response = await elasticsearchClient.search({ body, index });\n\n  if (response.body.hits.total.value === 0) {\n    ctx.throw(404, `there is no highlight that matches \"${slug}\"`);\n  }\n\n  ctx.body = response.body.hits.hits[0]._source.refs;\n});\n\nexport default router;\n"],"names":["elasticsearchClient","API_BASE_URL","CDTN_ADMIN_VERSION","Router","require","DOCUMENTS","getHightlightsBody","ES_INDEX_PREFIX","process","env","index","router","prefix","get","ctx","slug","params","body","response","search","hits","total","value","throw","_source","refs"],"mappings":"AAAA,OAAOA,yBAAyB,2BAA2B;AAC3D,SAASC,YAAY,EAAEC,kBAAkB,QAAQ,eAAe;AAEhE,MAAMC,SAASC,QAAQ;AACvB,MAAM,EAAEC,UAAS,EAAE,GAAGD,QAAQ;AAC9B,MAAME,qBAAqBF,QAAQ;AAEnC,MAAMG,kBAAkBC,QAAQC,GAAG,CAACF,eAAe,IAAI;AACvD,MAAMG,QAAQ,CAAC,EAAEH,gBAAgB,CAAC,EAAEL,mBAAmB,CAAC,EAAEG,UAAU,CAAC;AAErE,MAAMM,SAAS,IAAIR,OAAO;IAAES,QAAQX;AAAa;AAEjD;;;;;;;CAOC,GAEDU,OAAOE,GAAG,CAAC,qBAAqB,OAAOC,MAAQ;IAC7C,MAAM,EAAEC,KAAI,EAAE,GAAGD,IAAIE,MAAM;IAC3B,MAAMC,OAAOX,mBAAmB;QAAES;IAAK;IAEvC,MAAMG,WAAW,MAAMlB,oBAAoBmB,MAAM,CAAC;QAAEF;QAAMP;IAAM;IAEhE,IAAIQ,SAASD,IAAI,CAACG,IAAI,CAACC,KAAK,CAACC,KAAK,KAAK,GAAG;QACxCR,IAAIS,KAAK,CAAC,KAAK,CAAC,oCAAoC,EAAER,KAAK,CAAC,CAAC;IAC/D,CAAC;IAEDD,IAAIG,IAAI,GAAGC,SAASD,IAAI,CAACG,IAAI,CAACA,IAAI,CAAC,EAAE,CAACI,OAAO,CAACC,IAAI;AACpD;AAEA,eAAed,OAAO"}