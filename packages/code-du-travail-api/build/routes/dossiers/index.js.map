{"version":3,"sources":["../../../src/routes/dossiers/index.js"],"sourcesContent":["import elasticsearchClient from \"../../conf/elasticsearch\";\nimport { API_BASE_URL, CDTN_ADMIN_VERSION } from \"../v1.prefix\";\n\nconst Router = require(\"koa-router\");\nconst { DOCUMENTS } = require(\"@socialgouv/cdtn-elasticsearch\");\nconst { SOURCES } = require(\"@socialgouv/cdtn-sources\");\nconst getItemBySlugBody = require(\"../items/searchBySourceSlug.elastic\");\n\nconst router = new Router({ prefix: API_BASE_URL });\nconst ES_INDEX_PREFIX = process.env.ES_INDEX_PREFIX || \"cdtn\";\nconst index = `${ES_INDEX_PREFIX}-${CDTN_ADMIN_VERSION}_${DOCUMENTS}`;\n\n/**\n * Return thematic files that match a given slug\n *\n * @example\n * http://localhost:1337/api/v1/dossiers/:slug\n *\n * @returns {Object} An object containing the matching thematic file .\n */\n\nrouter.get(\"/dossiers/:slug\", async (ctx) => {\n  const { slug } = ctx.params;\n  const body = getItemBySlugBody({ slug, source: SOURCES.THEMATIC_FILES });\n  const response = await elasticsearchClient.search({ body, index });\n\n  if (response.body.hits.total.value === 0) {\n    ctx.throw(404, `there is no thematic files that match ${slug}`);\n  }\n\n  const thematicFile = response.body.hits.hits[0]._source;\n\n  ctx.body = {\n    ...thematicFile,\n  };\n});\n\nexport default router;\n"],"names":["elasticsearchClient","API_BASE_URL","CDTN_ADMIN_VERSION","Router","require","DOCUMENTS","SOURCES","getItemBySlugBody","router","prefix","ES_INDEX_PREFIX","process","env","index","get","ctx","slug","params","body","source","THEMATIC_FILES","response","search","hits","total","value","throw","thematicFile","_source"],"mappings":"AAAA,OAAOA,yBAAyB,2BAA2B;AAC3D,SAASC,YAAY,EAAEC,kBAAkB,QAAQ,eAAe;AAEhE,MAAMC,SAASC,QAAQ;AACvB,MAAM,EAAEC,UAAS,EAAE,GAAGD,QAAQ;AAC9B,MAAM,EAAEE,QAAO,EAAE,GAAGF,QAAQ;AAC5B,MAAMG,oBAAoBH,QAAQ;AAElC,MAAMI,SAAS,IAAIL,OAAO;IAAEM,QAAQR;AAAa;AACjD,MAAMS,kBAAkBC,QAAQC,GAAG,CAACF,eAAe,IAAI;AACvD,MAAMG,QAAQ,CAAC,EAAEH,gBAAgB,CAAC,EAAER,mBAAmB,CAAC,EAAEG,UAAU,CAAC;AAErE;;;;;;;CAOC,GAEDG,OAAOM,GAAG,CAAC,mBAAmB,OAAOC,MAAQ;IAC3C,MAAM,EAAEC,KAAI,EAAE,GAAGD,IAAIE,MAAM;IAC3B,MAAMC,OAAOX,kBAAkB;QAAES;QAAMG,QAAQb,QAAQc,cAAc;IAAC;IACtE,MAAMC,WAAW,MAAMrB,oBAAoBsB,MAAM,CAAC;QAAEJ;QAAML;IAAM;IAEhE,IAAIQ,SAASH,IAAI,CAACK,IAAI,CAACC,KAAK,CAACC,KAAK,KAAK,GAAG;QACxCV,IAAIW,KAAK,CAAC,KAAK,CAAC,sCAAsC,EAAEV,KAAK,CAAC;IAChE,CAAC;IAED,MAAMW,eAAeN,SAASH,IAAI,CAACK,IAAI,CAACA,IAAI,CAAC,EAAE,CAACK,OAAO;IAEvDb,IAAIG,IAAI,GAAG;QACT,GAAGS,YAAY;IACjB;AACF;AAEA,eAAenB,OAAO"}