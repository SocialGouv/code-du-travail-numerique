{"version":3,"sources":["../src/index.js"],"sourcesContent":["import { logger } from \"@socialgouv/cdtn-logger\";\n\nimport conventionsRoutes from \"./routes/conventions\";\nimport docsCountRoutes from \"./routes/docs-count\";\nimport dossiersRoute from \"./routes/dossiers\";\nimport enterprisesRoute from \"./routes/enterprises\";\nimport glossaryRoute from \"./routes/glossary\";\nimport highlightRoutes from \"./routes/highlights\";\nimport idccRoutes from \"./routes/idcc\";\nimport indexRoute from \"./routes/index\";\nimport itemsRoutes from \"./routes/items\";\nimport modelesRoutes from \"./routes/modeles\";\nimport searchRoutes from \"./routes/search\";\nimport sheetMTRoutes from \"./routes/sheets-mt\";\nimport statsRoute from \"./routes/stats\";\nimport suggestRoute from \"./routes/suggest\";\nimport themesRoute from \"./routes/themes\";\nimport versionRoutes from \"./routes/version\";\n\nconst Koa = require(\"koa\");\nconst bodyParser = require(\"koa-bodyparser\");\nconst cors = require(\"@koa/cors\");\n\nexport const app = new Koa();\nconst PORT = process.env.PORT || 1337;\n\napp.use(cors());\n/**\n * Log every request + catch errors and re-emit them\n * so we can centralize error handling / logging\n * https://github.com/koajs/koa/wiki/Error-Handling\n */\napp.use(async (ctx, next) => {\n  try {\n    logger.info(`Request ${ctx.request.method} ${ctx.request.url}`);\n    await next();\n  } catch (error) {\n    logger.error(error);\n    const { statusCode = 500, message } = error;\n    ctx.throw(statusCode, message);\n    ctx.app.emit(\"error\", error);\n  }\n});\n\n/**\n * use a middleware for IE 10+ http xmlhttp requests\n * https://blogs.msdn.microsoft.com/ieinternals/2013/09/17/a-quick-look-at-p3p/\n */\napp.use(async (ctx, next) => {\n  ctx.set(\"P3P\", \"NOI ADM DEV PSAi OUR OTRo STP IND COM NAV DEM\");\n  await next();\n});\n\napp.use(bodyParser());\n\napp.use(enterprisesRoute.routes());\napp.use(conventionsRoutes.routes());\napp.use(docsCountRoutes.routes());\napp.use(highlightRoutes.routes());\napp.use(idccRoutes.routes());\napp.use(itemsRoutes.routes());\napp.use(modelesRoutes.routes());\napp.use(searchRoutes.routes());\napp.use(sheetMTRoutes.routes());\napp.use(statsRoute.routes());\napp.use(suggestRoute.routes());\napp.use(themesRoute.routes());\napp.use(dossiersRoute.routes());\napp.use(glossaryRoute.routes());\napp.use(versionRoutes.routes());\napp.use(indexRoute.routes());\n\nif (process.env.NODE_ENV !== \"production\") {\n  logger.info(\"--- DEV MODE ---\");\n}\n\n// Server.\nconst server = app.listen(PORT, () => {\n  logger.info(`Server listening on port: ${PORT}`);\n});\n\nexport default server;\n"],"names":["logger","conventionsRoutes","docsCountRoutes","dossiersRoute","enterprisesRoute","glossaryRoute","highlightRoutes","idccRoutes","indexRoute","itemsRoutes","modelesRoutes","searchRoutes","sheetMTRoutes","statsRoute","suggestRoute","themesRoute","versionRoutes","Koa","require","bodyParser","cors","app","PORT","process","env","use","ctx","next","info","request","method","url","error","statusCode","message","throw","emit","set","routes","NODE_ENV","server","listen"],"mappings":"AAAA,SAASA,MAAM,QAAQ,0BAA0B;AAEjD,OAAOC,uBAAuB,uBAAuB;AACrD,OAAOC,qBAAqB,sBAAsB;AAClD,OAAOC,mBAAmB,oBAAoB;AAC9C,OAAOC,sBAAsB,uBAAuB;AACpD,OAAOC,mBAAmB,oBAAoB;AAC9C,OAAOC,qBAAqB,sBAAsB;AAClD,OAAOC,gBAAgB,gBAAgB;AACvC,OAAOC,gBAAgB,iBAAiB;AACxC,OAAOC,iBAAiB,iBAAiB;AACzC,OAAOC,mBAAmB,mBAAmB;AAC7C,OAAOC,kBAAkB,kBAAkB;AAC3C,OAAOC,mBAAmB,qBAAqB;AAC/C,OAAOC,gBAAgB,iBAAiB;AACxC,OAAOC,kBAAkB,mBAAmB;AAC5C,OAAOC,iBAAiB,kBAAkB;AAC1C,OAAOC,mBAAmB,mBAAmB;AAE7C,MAAMC,MAAMC,QAAQ;AACpB,MAAMC,aAAaD,QAAQ;AAC3B,MAAME,OAAOF,QAAQ;AAErB,OAAO,MAAMG,MAAM,IAAIJ,MAAM;AAC7B,MAAMK,OAAOC,QAAQC,GAAG,CAACF,IAAI,IAAI;AAEjCD,IAAII,GAAG,CAACL;AACR;;;;CAIC,GACDC,IAAII,GAAG,CAAC,OAAOC,KAAKC,OAAS;IAC3B,IAAI;QACF3B,OAAO4B,IAAI,CAAC,CAAC,QAAQ,EAAEF,IAAIG,OAAO,CAACC,MAAM,CAAC,CAAC,EAAEJ,IAAIG,OAAO,CAACE,GAAG,CAAC,CAAC;QAC9D,MAAMJ;IACR,EAAE,OAAOK,OAAO;QACdhC,OAAOgC,KAAK,CAACA;QACb,MAAM,EAAEC,YAAa,IAAG,EAAEC,QAAO,EAAE,GAAGF;QACtCN,IAAIS,KAAK,CAACF,YAAYC;QACtBR,IAAIL,GAAG,CAACe,IAAI,CAAC,SAASJ;IACxB;AACF;AAEA;;;CAGC,GACDX,IAAII,GAAG,CAAC,OAAOC,KAAKC,OAAS;IAC3BD,IAAIW,GAAG,CAAC,OAAO;IACf,MAAMV;AACR;AAEAN,IAAII,GAAG,CAACN;AAERE,IAAII,GAAG,CAACrB,iBAAiBkC,MAAM;AAC/BjB,IAAII,GAAG,CAACxB,kBAAkBqC,MAAM;AAChCjB,IAAII,GAAG,CAACvB,gBAAgBoC,MAAM;AAC9BjB,IAAII,GAAG,CAACnB,gBAAgBgC,MAAM;AAC9BjB,IAAII,GAAG,CAAClB,WAAW+B,MAAM;AACzBjB,IAAII,GAAG,CAAChB,YAAY6B,MAAM;AAC1BjB,IAAII,GAAG,CAACf,cAAc4B,MAAM;AAC5BjB,IAAII,GAAG,CAACd,aAAa2B,MAAM;AAC3BjB,IAAII,GAAG,CAACb,cAAc0B,MAAM;AAC5BjB,IAAII,GAAG,CAACZ,WAAWyB,MAAM;AACzBjB,IAAII,GAAG,CAACX,aAAawB,MAAM;AAC3BjB,IAAII,GAAG,CAACV,YAAYuB,MAAM;AAC1BjB,IAAII,GAAG,CAACtB,cAAcmC,MAAM;AAC5BjB,IAAII,GAAG,CAACpB,cAAciC,MAAM;AAC5BjB,IAAII,GAAG,CAACT,cAAcsB,MAAM;AAC5BjB,IAAII,GAAG,CAACjB,WAAW8B,MAAM;AAEzB,IAAIf,QAAQC,GAAG,CAACe,QAAQ,KAAK,cAAc;IACzCvC,OAAO4B,IAAI,CAAC;AACd,CAAC;AAED,UAAU;AACV,MAAMY,SAASnB,IAAIoB,MAAM,CAACnB,MAAM,IAAM;IACpCtB,OAAO4B,IAAI,CAAC,CAAC,0BAA0B,EAAEN,KAAK,CAAC;AACjD;AAEA,eAAekB,OAAO"}